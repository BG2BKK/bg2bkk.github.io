
<!DOCTYPE html>
<html lang="">

    <head>

        <meta charset="utf-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />

        <meta property="og:title" content=" pipe在内核中的实现 &middot;  BG2BKK Site" />
        <meta property="og:site_name" content="BG2BKK Site" />
        <meta property="og:url" content="https://bg2bkk.github.io/post/pipe%E5%9C%A8%E5%86%85%E6%A0%B8%E4%B8%AD%E7%9A%84%E5%AE%9E%E7%8E%B0/" />

    
        <meta property="og:type" content="article" />
        <meta property="og:article:published_time" content="2016-02-27T09:49:41&#43;08:00" />
        <meta property="og:article:tag" content="linux kenrel" />
        

        <meta name="twitter:card" content="summary" />
        <meta name="twitter:site" content="@" />
        <meta name="twitter:creator" content="@" />
        <meta name="twitter:title" content="pipe在内核中的实现" />
        <meta name="twitter:description" content="" />
        <meta name="twitter:url" content="https://bg2bkk.github.io/post/pipe%E5%9C%A8%E5%86%85%E6%A0%B8%E4%B8%AD%E7%9A%84%E5%AE%9E%E7%8E%B0/" />
    

        <title> pipe在内核中的实现 &middot;  BG2BKK Site</title>

    
        <meta name="description" content="" />
    
        
        <meta name="p:domain_verify" content="fc173d84e3a4de948ed4bda2908afd3e"/>
        <meta name="HandheldFriendly" content="True" />
        <meta name="MobileOptimized" content="320" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />

        
          

    
        <link href="https://bg2bkk.github.io/index.xml" rel="alternate" type="application/rss+xml" title="BG2BKK Site" />
    

    
        <link rel="canonical" href="https://bg2bkk.github.io/post/pipe%E5%9C%A8%E5%86%85%E6%A0%B8%E4%B8%AD%E7%9A%84%E5%AE%9E%E7%8E%B0/" />

    
    <script type="application/ld+json">
    { 
        "@context": "http://schema.org",
        "@type": "Article",
        "headline": "pipe在内核中的实现",
        "author": {
            "@type": "Person",
            "name": "http://profiles.google.com/?rel=author"
        },
        "datePublished": "2016-02-27",
        "description": "",
        "wordCount":  1148 
    }
    </script>
    
    
    <style>
*{padding:0;margin:0}body,html{font-size:1em;line-height:1.65em;font-family:"Open Sans",sans-serif;font-weight:300;color:#444}html{height:100%}body{padding:2em 2.5em 1em 20em}header{border-right:1px #eee solid;padding:2em;position:fixed;top:0;left:0;height:100%;width:13.5em}#content{display:block;width:100%}footer{padding:1em 0 2.5em;font-size:.8em;line-height:1.5em;color:#888}article{border-bottom:.1em #eee solid;padding-bottom:1.7em;max-width:56em}h4,h5,h6,hr,p{margin-top:.9em;margin-bottom:.9em}h1,h2,h3,h4,h5,h6{font-family:"Microsoft Yahei",serif;font-weight:400!important}h1{font-size:2.5em;line-height:1.1em;margin-top:.6em;margin-bottom:.6em}h2{font-size:1.9em;line-height:1.2em;margin-top:.7em;margin-bottom:.7em}h3{font-size:1.4em;line-height:1.3em;margin-top:.8em;margin-bottom:.8em}h4{font-size:1.3em}h5{font-size:1.2em}h6{font-size:1.1em}iframe,img{max-width:100%}a{font-weight:700;text-decoration:none;color:#5cc265}a:hover{text-decoration:underline}h1 a,h2 a,h3 a,h4 a,h5 a,h6 a{font-weight:400!important}strong{font-weight:700}blockquote{border-left:.4em solid #eee;padding-left:1.2em;font-size:1.3em}hr{border:0;height:1px;background:#eee}ol,ul{margin-left:3em}code{font-size:1.4em;background:#eee}pre{font-size:.8em;line-height:2em;background:#eee;padding:1em;word-break:break-all;word-wrap:break-word;white-space:pre;white-space:-moz-pre-wrap;white-space:pre-wrap}input{font-size:1em;padding:.3em}header h1{font-size:1.9em;margin-top:.8em;margin-bottom:.6em}header h1 a{color:#444}header h1 a:hover{text-decoration:none}header #logo img{width:9em;height:9em;border-radius:4.5em;-moz-border-radius:4.5em;-webkit-border-radius:4.5em;border:none}#follow-icons{font-size:.7em;margin-top:-.7em;margin-bottom:1.5em}#follow-icons a{color:#ccc}#follow-icons span{vertical-align:top;margin-left:-.15em;margin-right:-.15em}#follow-icons span .fa-stack-1x{font-size:1.05em;line-height:1.9em}header h6{margin-top:.5em}article span.post-stamp{color:#888}h1.post-title{margin-top:.35em;margin-bottom:.6em}h3.post-title{margin-top:.4em;padding-bottom:.9em;border-bottom:1px solid #eee;font-size:1.2em;color:#444}.post-title time{font-size:0.5em}.post-title a{color:#494949;font-family:"Bree Serif",serif;}.post-title .feature-star{font-size:.9em}.feature-star,.separator,.taglist{color:#ccc}.taglist a{background-color:#ccc;color:#fff;display:inline-block;line-height:1.5em;padding:.3em .6em;vertical-align:20%;font-size:.5em;font-family:"Open Sans",sans-serif;font-weight:700!important;text-transform:uppercase;letter-spacing:.05em;border-radius:.25em;-moz-border-radius:.25em;-webkit-border-radius:.25em}#social-bar{margin-top:1.5em;background-color:#eee;padding:.5em}#comments{margin-top:.15em;padding-bottom:.2em;border-bottom:1px solid #eee}.pagination{margin-bottom:1em}footer a{font-weight:300;color:#888;text-decoration:underline}footer a:hover{color:#444;text-decoration:none}@media only screen and (min-width:1281px){body,html{font-size:1.1em}}@media only screen and (max-width:800px){body{padding:0}header{border-right:none;border-bottom:1px #eee solid;position:relative;height:auto;width:auto;text-align:center;padding-bottom:1em}#content{margin-left:0;padding:2em 2em 1em;width:auto}footer{padding:0 2.5em 2em}}@media only screen and (max-width:320px){#content,header{padding:1.2em 1.2em .6em}footer{padding:0 1.5em 1.2em}ol,ul{margin-left:2em}}
</style>

    </head>
    <body>
        <header id="header">
            
            <a id="logo" href="https://bg2bkk.github.io/"><img src="https://raw.githubusercontent.com/BG2BKK/githubio/master/themes/crisp/images/eagle.jpg" alt="BG2BKK Site" /></a> 
            <h1><a href="https://bg2bkk.github.io/">BG2BKK Site</a></h1>
            <p></p>

            <div id="follow-icons">
	<a href="http://facebook.com/bg2bkk" rel="me"><i class="fa fa-facebook-square fa-2x"></i></a>
	<a href="http://twitter.com/bg2bkk1" rel="me"><i class="fa fa-twitter-square fa-2x"></i></a>
	<a href="http://github.com/bg2bkk" rel="me"><i class="fa fa-linkedin-square fa-2x"></i></a>
	<a href="http://github.com/bg2bkk" rel="me"><i class="fa fa-github-square fa-2x"></i></a>
	<a href="http://plus.google.com/bg2bkk" rel="author"><i class="fa fa-google-plus-square fa-2x"></i></a>
	<a href="https://bg2bkk.github.io/index.xml" rel="me"><i class="fa fa-rss-square fa-2x"></i></a> 
</div>  

            <h6><a href="https://bg2bkk.github.io/post/resume/">About</a></h6>

        </header>

<main id="content">

<article id="" class="post">
    <div class="post-stamp">
        <time datetime="2016-02-27T09:49:41&#43;08:00">
            27 Feb 2016
        </time>
        <span class="taglist">
        
        &middot;
        
            <a href="https://bg2bkk.github.io/tags/linux-kenrel/">linux kenrel</a>
        
        
        </span>
    </div>
    <h1 class="post-title">pipe在内核中的实现</h1>
    

<h2 id="pipe在linux内核中的实现:eef8af46b03027cdd30025ef9f062910">pipe在linux内核中的实现</h2>

<p>在之前关于linux shell多线程并发数控制的<a href="https://bg2bkk.github.io/post/shell%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%AE%9E%E8%B7%B5/">博文</a>中，我们使用了fifo作为token池，通过读写fifo实现token分发控制，进而实现了控制线程数的目的。
我对pipe这个*** *NIX ***系统中最常用的组件（|）产生了兴趣</p>

<ul>
<li>fifo和pipe是什么关系？</li>
<li>fifo或者pipe的使用方法？</li>
<li>pipe在linux kernel中的实现是怎样的？</li>
<li>fifo或者pipe的容量有多大，可以配置吗？</li>
</ul>

<p>先说结论吧</p>

<ul>
<li>fifo和pipe的区别

<ul>
<li>pipe是匿名管道，没有名字，只能用于两个拥有pipe读写两端fd的进程通信；</li>
<li>fifo在文件系统中有自己的名称，操作fifo与操作普通文件几无差别，可以用于两个没有关系的进程间通信</li>
</ul></li>
<li>fifo和pipe在kernel层面上都实现在fs/pipe.c中，所以本质上二者是一个东西。</li>
<li>pipe作为linux文件系统的一部分，与epoll一样，都是在向kernel注册了自己的文件系统，可以使用VFS提供的通用接口，比如open、read和write等操作</li>
<li>pipe的容量不是无限大的，早期linux版本（kernel-2.4）中pipe容量只能是4KB大小，新版本可以在运行时根据需要扩大到64KB</li>
</ul>

<p>本文主要基于linux-2.4.20内核中的pipe实现进行分析，理由是该版本的pipe实现与新版本kernel并没有太大差别，但是代码可读性要强很多，可以快速了解pipe的实际实现；从2.4.20内核中对pipe的架构有整体了解后，再阅读新版本(4.4.1)中的新feature，会比较顺遂。</p>

<h3 id="pipe在fs-pipe-c中一些函数:eef8af46b03027cdd30025ef9f062910">pipe在fs/pipe.c中一些函数</h3>

<pre><code>- new_inode()
- register_filesystem()
- get_empty_file
- get_unused_fd()
- do_pipe作为pipe系统调用函数，在/arch/i386/sys_i386.c中定义
- pipe的module_init在initcall中调用，但是pipe.c是编译在fs.o中的，他的module_init是如何调用进去的，需要进一步查找
- struct dentry在include/linux/dcache.h中定义
</code></pre>

<h3 id="具体实现:eef8af46b03027cdd30025ef9f062910">具体实现</h3>

<pre><code>* pipe文件系统初始化
    * 注册pipefs
        * register_filesystems

* pipe系统调用
    * pipe调用do_pipe
    * do_pipe()
        * f1&amp;f2 get_empty_filep分配filep数据结构
        * inode = get_pipe_inode()从pipe文件系统获得inode
            * new_inode()
            * pipe_new()新建pipe
                * __get_free_pages(GFP_USER)为该pipe分配一页内存（4KB）
                * inode-&gt;i_pipe = kmalloc(sizeof(struct pipe_inde_info), GFP_KERNEL)分配pipe信息结构
        * i&amp;j = get_unused_fd()获取两个fd
        * dentry = d_alloc()从pipefs分配dentry
        * d_add(dentry, inode)将inode插入到dentry中
        * 将f1设置成O_RDONLY，将f2设置成O_WRONLY
        * 进程的files列表中，files[i] = f1, files[j] = f2

* 实现函数
    * pipe
        * pipe_read
        * pipe_write
</code></pre>

<ul>
<li><p>tips</p>

<ul>
<li>pipe不允许使用seek</li>
<li>低版本linux-2.4.20在pipe写的时候是固定大小，而高版本的是会按需分配直至64KB的。</li>

<li><p>高版本kernel内核中sysctl的配置参数<strong><em>fs.pipe-max-size</em></strong> 可以设置固定的pipe大小。但是也不能超过64KB大小，即使配置数据大于这个数字，pipe大小也会限制在64KB。</p></li>

<li><p><a href="http://unix.stackexchange.com/questions/11946/how-big-is-the-pipe-buffer">测试代码</a></p></li>
</ul></li>
</ul>

<pre><code class="language-bash">#!/bin/bash
test $# -ge 1 || { echo &quot;usage: $0 write-size [wait-time]&quot;; exit 1; }
test $# -ge 2 || set -- &quot;$@&quot; 1
bytes_written=$(
{
    exec 3&gt;&amp;1
    {
        perl -e '
            $size = $ARGV[0];
            $block = q(a) x $size;
            $num_written = 0;
            sub report { print STDERR $num_written * $size, qq(\n); }
            report; while (defined syswrite STDOUT, $block) {
                $num_written++; report;
            }
        ' &quot;$1&quot; 2&gt;&amp;3
    } | (sleep &quot;$2&quot;; exec 0&lt;&amp;-);
} | tail -1
)
printf &quot;write size: %10d; bytes successfully before error: %d\n&quot; \
    &quot;$1&quot; &quot;$bytes_written&quot;

</code></pre>

<pre><code>* 测试结果
</code></pre>

<pre><code>huang@ThinkPad-X220:~/workspace/cpp$ /bin/bash -c 'for p in {0..18}; do ./pipe.sh $((2 ** $p)) 0.5; done'
write size:          1; bytes successfully before error: 65536
write size:          2; bytes successfully before error: 65536
write size:          4; bytes successfully before error: 65536
write size:          8; bytes successfully before error: 65536
write size:         16; bytes successfully before error: 65536
write size:         32; bytes successfully before error: 65536
write size:         64; bytes successfully before error: 65536
write size:        128; bytes successfully before error: 65536
write size:        256; bytes successfully before error: 65536
write size:        512; bytes successfully before error: 65536
write size:       1024; bytes successfully before error: 65536
write size:       2048; bytes successfully before error: 65536
write size:       4096; bytes successfully before error: 65536
write size:       8192; bytes successfully before error: 65536
write size:      16384; bytes successfully before error: 65536
write size:      32768; bytes successfully before error: 65536
write size:      65536; bytes successfully before error: 65536
write size:     131072; bytes successfully before error: 0
write size:     262144; bytes successfully before error: 0

</code></pre>

<pre><code>* 内核中64KB大小的限制在哪里设置的？(TO DO)
    * 只有在高版本的pipe实现中才有64KB大小，低版本都是4KB的。
    * ulimit -a 的结果中，&quot;pipe size (512 bytes, -p) 8&quot;，表示一个pipe拥有8个512KB的buffer，总共是4KB
    * 在include/linux/fs_pipe_i.h中，#define PIPE_DEF_BUFFERS   16, 这里是[按buffer的数量分配的](http://home.gna.org/pysfst/tests/pipe-limit.html)。
    * 在fs/pipe.c中，pipe_write和pipe_read是在运行时按页大小分配的
    * sysctl中fs.max_pipe_size的设置，fs.pipe-max-size = 1048576，又会起什么作用
</code></pre>

<ul>
<li>函数分析

<ul>
<li>init_pipe_fs向文件系统注册pipe组件</li>
</ul></li>
</ul>

<pre><code class="language-cpp">static int __init init_pipe_fs(void)
{
	int err = register_filesystem(&amp;pipe_fs_type);
	if (!err) {
		pipe_mnt = kern_mount(&amp;pipe_fs_type);
		err = PTR_ERR(pipe_mnt);
		if (IS_ERR(pipe_mnt))
			unregister_filesystem(&amp;pipe_fs_type);
		else
			err = 0;
	}
	return err;
}
</code></pre>

<pre><code class="language-cpp">static DECLARE_FSTYPE(pipe_fs_type, &quot;pipefs&quot;, pipefs_read_super, FS_NOMOUNT);
</code></pre>

<pre><code class="language-cpp">#define DECLARE_FSTYPE(var,type,read,flags) \
struct file_system_type var = { \
	name:		type, \
	read_super:	read, \
	fs_flags:	flags, \
	owner:		THIS_MODULE, \
}
</code></pre>

<pre><code>* pipe源码（2.4的实现中实在没什么可讲的，比较有价值的是pipe_write和pipe_read中处理缓冲队列源码可以参考）
</code></pre>

<pre><code class="language-cpp">/*
 * We use a start+len construction, which provides full use of the 
 * allocated memory.
 * -- Florian Coosmann (FGC)
 * 
 * Reads with count = 0 should always return 0.
 * -- Julian Bradfield 1999-06-07.
 */

/* Drop the inode semaphore and wait for a pipe event, atomically */
void pipe_wait(struct inode * inode)
{
	DECLARE_WAITQUEUE(wait, current);
	current-&gt;state = TASK_INTERRUPTIBLE;
	add_wait_queue(PIPE_WAIT(*inode), &amp;wait);
	up(PIPE_SEM(*inode));
	schedule();
	remove_wait_queue(PIPE_WAIT(*inode), &amp;wait);
	current-&gt;state = TASK_RUNNING;
	down(PIPE_SEM(*inode));
}

static ssize_t
pipe_read(struct file *filp, char *buf, size_t count, loff_t *ppos)
{
	struct inode *inode = filp-&gt;f_dentry-&gt;d_inode;
	ssize_t size, read, ret;

	/* Seeks are not allowed on pipes.  */
	ret = -ESPIPE;
	read = 0;
	if (ppos != &amp;filp-&gt;f_pos)
		goto out_nolock;

	/* Always return 0 on null read.  */
	ret = 0;
	if (count == 0)
		goto out_nolock;

	/* Get the pipe semaphore */
	ret = -ERESTARTSYS;
	if (down_interruptible(PIPE_SEM(*inode)))
		goto out_nolock;

	if (PIPE_EMPTY(*inode)) {
do_more_read:
		ret = 0;
		if (!PIPE_WRITERS(*inode))
			goto out;

		ret = -EAGAIN;
		if (filp-&gt;f_flags &amp; O_NONBLOCK)
			goto out;

		for (;;) {
			PIPE_WAITING_READERS(*inode)++;
			pipe_wait(inode);
			PIPE_WAITING_READERS(*inode)--;
			ret = -ERESTARTSYS;
			if (signal_pending(current))
				goto out;
			ret = 0;
			if (!PIPE_EMPTY(*inode))
				break;
			if (!PIPE_WRITERS(*inode))
				goto out;
		}
	}

	/* Read what data is available.  */
	ret = -EFAULT;
	while (count &gt; 0 &amp;&amp; (size = PIPE_LEN(*inode))) {
		char *pipebuf = PIPE_BASE(*inode) + PIPE_START(*inode);
		ssize_t chars = PIPE_MAX_RCHUNK(*inode);

		if (chars &gt; count)
			chars = count;
		if (chars &gt; size)
			chars = size;

		if (copy_to_user(buf, pipebuf, chars))
			goto out;

		read += chars;
		PIPE_START(*inode) += chars;
		PIPE_START(*inode) &amp;= (PIPE_SIZE - 1);
		PIPE_LEN(*inode) -= chars;
		count -= chars;
		buf += chars;
	}

	/* Cache behaviour optimization */
	if (!PIPE_LEN(*inode))
		PIPE_START(*inode) = 0;

	if (count &amp;&amp; PIPE_WAITING_WRITERS(*inode) &amp;&amp; !(filp-&gt;f_flags &amp; O_NONBLOCK)) {
		/*
		 * We know that we are going to sleep: signal
		 * writers synchronously that there is more
		 * room.
		 */
		wake_up_interruptible_sync(PIPE_WAIT(*inode));
		if (!PIPE_EMPTY(*inode))
			BUG();
		goto do_more_read;
	}
	/* Signal writers asynchronously that there is more room.  */
	wake_up_interruptible(PIPE_WAIT(*inode));

	ret = read;
out:
	up(PIPE_SEM(*inode));
out_nolock:
	if (read)
		ret = read;

	UPDATE_ATIME(inode);
	return ret;
}

static ssize_t
pipe_write(struct file *filp, const char *buf, size_t count, loff_t *ppos)
{
	struct inode *inode = filp-&gt;f_dentry-&gt;d_inode;
	ssize_t free, written, ret;

	/* Seeks are not allowed on pipes.  */
	ret = -ESPIPE;
	written = 0;
	if (ppos != &amp;filp-&gt;f_pos)
		goto out_nolock;

	/* Null write succeeds.  */
	ret = 0;
	if (count == 0)
		goto out_nolock;

	ret = -ERESTARTSYS;
	if (down_interruptible(PIPE_SEM(*inode)))
		goto out_nolock;

	/* No readers yields SIGPIPE.  */
	if (!PIPE_READERS(*inode))
		goto sigpipe;

	/* If count &lt;= PIPE_BUF, we have to make it atomic.  */
	free = (count &lt;= PIPE_BUF ? count : 1);

	/* Wait, or check for, available space.  */
	if (filp-&gt;f_flags &amp; O_NONBLOCK) {
		ret = -EAGAIN;
		if (PIPE_FREE(*inode) &lt; free)
			goto out;
	} else {
		while (PIPE_FREE(*inode) &lt; free) {
			PIPE_WAITING_WRITERS(*inode)++;
			pipe_wait(inode);
			PIPE_WAITING_WRITERS(*inode)--;
			ret = -ERESTARTSYS;
			if (signal_pending(current))
				goto out;

			if (!PIPE_READERS(*inode))
				goto sigpipe;
		}
	}

	/* Copy into available space.  */
	ret = -EFAULT;
	while (count &gt; 0) {
		int space;
		char *pipebuf = PIPE_BASE(*inode) + PIPE_END(*inode);
		ssize_t chars = PIPE_MAX_WCHUNK(*inode);

		if ((space = PIPE_FREE(*inode)) != 0) {
			if (chars &gt; count)
				chars = count;
			if (chars &gt; space)
				chars = space;

			if (copy_from_user(pipebuf, buf, chars))
				goto out;

			written += chars;
			PIPE_LEN(*inode) += chars;
			count -= chars;
			buf += chars;
			space = PIPE_FREE(*inode);
			continue;
		}

		ret = written;
		if (filp-&gt;f_flags &amp; O_NONBLOCK)
			break;

		do {
			/*
			 * Synchronous wake-up: it knows that this process
			 * is going to give up this CPU, so it doesn't have
			 * to do idle reschedules.
			 */
			wake_up_interruptible_sync(PIPE_WAIT(*inode));
			PIPE_WAITING_WRITERS(*inode)++;
			pipe_wait(inode);
			PIPE_WAITING_WRITERS(*inode)--;
			if (signal_pending(current))
				goto out;
			if (!PIPE_READERS(*inode))
				goto sigpipe;
		} while (!PIPE_FREE(*inode));
		ret = -EFAULT;
	}

	/* Signal readers asynchronously that there is more data.  */
	wake_up_interruptible(PIPE_WAIT(*inode));

	inode-&gt;i_ctime = inode-&gt;i_mtime = CURRENT_TIME;
	mark_inode_dirty(inode);

out:
	up(PIPE_SEM(*inode));
out_nolock:
	if (written)
		ret = written;
	return ret;

sigpipe:
	if (written)
		goto out;
	up(PIPE_SEM(*inode));
	send_sig(SIGPIPE, current, 0);
	return -EPIPE;
}


/* No kernel lock held - fine */
static unsigned int
pipe_poll(struct file *filp, poll_table *wait)
{
	unsigned int mask;
	struct inode *inode = filp-&gt;f_dentry-&gt;d_inode;

	poll_wait(filp, PIPE_WAIT(*inode), wait);

	/* Reading only -- no need for acquiring the semaphore.  */
	mask = POLLIN | POLLRDNORM;
	if (PIPE_EMPTY(*inode))
		mask = POLLOUT | POLLWRNORM;
	if (!PIPE_WRITERS(*inode) &amp;&amp; filp-&gt;f_version != PIPE_WCOUNTER(*inode))
		mask |= POLLHUP;
	if (!PIPE_READERS(*inode))
		mask |= POLLERR;

	return mask;
}

</code></pre>

    <div id="social-bar">
	<ul class="rrssb-buttons clearfix">
      <li class="email">
          <a href="mailto:?subject=pipe%e5%9c%a8%e5%86%85%e6%a0%b8%e4%b8%ad%e7%9a%84%e5%ae%9e%e7%8e%b0&amp;body=https://bg2bkk.github.io/post/pipe%E5%9C%A8%E5%86%85%E6%A0%B8%E4%B8%AD%E7%9A%84%E5%AE%9E%E7%8E%B0/">
              <span class="icon">
                  <svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="28px" height="28px" viewBox="0 0 28 28" enable-background="new 0 0 28 28" xml:space="preserve">
                      <path transform="scale(0.014,-0.014) translate(0,-1670)" d="M1792 826v-794q0 -66 -47 -113t-113 -47h-1472q-66 0 -113 47t-47 113v794q44 -49 101 -87q362 -246 497 -345q57 -42 92.5 -65.5t94.5 -48t110 -24.5h1h1q51 0 110 24.5t94.5 48t92.5 65.5q170 123 498 345q57 39 100 87zM1792 1120q0 -79 -49 -151t-122 -123 q-376 -261 -468 -325q-10 -7 -42.5 -30.5t-54 -38t-52 -32.5t-57.5 -27t-50 -9h-1h-1q-23 0 -50 9t-57.5 27t-52 32.5t-54 38t-42.5 30.5q-91 64 -262 182.5t-205 142.5q-62 42 -117 115.5t-55 136.5q0 78 41.5 130t118.5 52h1472q65 0 112.5 -47t47.5 -113z"/>
                  </svg>
              </span>
              <span class="text">Email</span>
          </a>
      </li>
      <li class="facebook">
          <a href="https://www.facebook.com/sharer/sharer.php?u=https://bg2bkk.github.io/post/pipe%E5%9C%A8%E5%86%85%E6%A0%B8%E4%B8%AD%E7%9A%84%E5%AE%9E%E7%8E%B0/" class="popup">
              <span class="icon">
                  <svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="28px" height="28px" viewBox="0 0 28 28" enable-background="new 0 0 28 28" xml:space="preserve">
                      <path d="M27.825,4.783c0-2.427-2.182-4.608-4.608-4.608H4.783c-2.422,0-4.608,2.182-4.608,4.608v18.434 c0,2.427,2.181,4.608,4.608,4.608H14V17.379h-3.379v-4.608H14v-1.795c0-3.089,2.335-5.885,5.192-5.885h3.718v4.608h-3.726 c-0.408,0-0.884,0.492-0.884,1.236v1.836h4.609v4.608h-4.609v10.446h4.916c2.422,0,4.608-2.188,4.608-4.608V4.783z"/>
                  </svg>
              </span>
              <span class="text">Facebook</span>
          </a>
      </li>
			<li class="twitter">
          <a href="http://twitter.com/home?status=pipe%e5%9c%a8%e5%86%85%e6%a0%b8%e4%b8%ad%e7%9a%84%e5%ae%9e%e7%8e%b0%20https://bg2bkk.github.io/post/pipe%E5%9C%A8%E5%86%85%E6%A0%B8%E4%B8%AD%E7%9A%84%E5%AE%9E%E7%8E%B0/" class="popup">
              <span class="icon">
                  <svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="28px" height="28px" viewBox="0 0 28 28" enable-background="new 0 0 28 28" xml:space="preserve">
		                  <path d="M24.253,8.756C24.689,17.08,18.297,24.182,9.97,24.62c-3.122,0.162-6.219-0.646-8.861-2.32 c2.703,0.179,5.376-0.648,7.508-2.321c-2.072-0.247-3.818-1.661-4.489-3.638c0.801,0.128,1.62,0.076,2.399-0.155 C4.045,15.72,2.215,13.6,2.115,11.077c0.688,0.275,1.426,0.407,2.168,0.386c-2.135-1.65-2.729-4.621-1.394-6.965 C5.575,7.816,9.54,9.84,13.803,10.071c-0.842-2.739,0.694-5.64,3.434-6.482c2.018-0.623,4.212,0.044,5.546,1.683 c1.186-0.213,2.318-0.662,3.329-1.317c-0.385,1.256-1.247,2.312-2.399,2.942c1.048-0.106,2.069-0.394,3.019-0.851 C26.275,7.229,25.39,8.196,24.253,8.756z"/>
                  </svg>
              </span>
              <span class="text">Twitter</span>
          </a>
      </li>
			<li class="linkedin">
          <a href="http://www.linkedin.com/shareArticle?mini=true&amp;url=https://bg2bkk.github.io/post/pipe%E5%9C%A8%E5%86%85%E6%A0%B8%E4%B8%AD%E7%9A%84%E5%AE%9E%E7%8E%B0/&amp;title=pipe%e5%9c%a8%e5%86%85%e6%a0%b8%e4%b8%ad%e7%9a%84%e5%ae%9e%e7%8e%b0&amp;summary=pipe%e5%9c%a8linux%e5%86%85%e6%a0%b8%e4%b8%ad%e7%9a%84%e5%ae%9e%e7%8e%b0%20%e5%9c%a8%e4%b9%8b%e5%89%8d%e5%85%b3%e4%ba%8elinux%20shell%e5%a4%9a%e7%ba%bf%e7%a8%8b%e5%b9%b6%e5%8f%91%e6%95%b0%e6%8e%a7%e5%88%b6%e7%9a%84%e5%8d%9a%e6%96%87%e4%b8%ad%ef%bc%8c%e6%88%91%e4%bb%ac%e4%bd%bf%e7%94%a8%e4%ba%86fifo%e4%bd%9c%e4%b8%batoken%e6%b1%a0%ef%bc%8c%e9%80%9a%e8%bf%87%e8%af%bb%e5%86%99fifo%e5%ae%9e%e7%8e%b0token%e5%88%86%e5%8f%91%e6%8e%a7%e5%88%b6%ef%bc%8c%e8%bf%9b%e8%80%8c%e5%ae%9e%e7%8e%b0%e4%ba%86%e6%8e%a7%e5%88%b6%e7%ba%bf%e7%a8%8b%e6%95%b0%e7%9a%84%e7%9b%ae%e7%9a%84%e3%80%82%20%e6%88%91%e5%af%b9pipe%e8%bf%99%e4%b8%aa%2a%2a%2a%20%2aNIX%20%2a%2a%2a%e7%b3%bb%e7%bb%9f%e4%b8%ad%e6%9c%80%e5%b8%b8%e7%94%a8%e7%9a%84%e7%bb%84%e4%bb%b6%ef%bc%88%7c%ef%bc%89%e4%ba%a7%e7%94%9f%e4%ba%86%e5%85%b4%e8%b6%a3%20fifo%e5%92%8cpipe%e6%98%af%e4%bb%80%e4%b9%88%e5%85%b3%e7%b3%bb%ef%bc%9f%20fifo%e6%88%96%e8%80%85pipe%e7%9a%84%e4%bd%bf%e7%94%a8%e6%96%b9%e6%b3%95%ef%bc%9f%20pipe%e5%9c%a8linux%20kernel%e4%b8%ad%e7%9a%84%e5%ae%9e%e7%8e%b0%e6%98%af%e6%80%8e%e6%a0%b7%e7%9a%84%ef%bc%9f%20fifo%e6%88%96%e8%80%85pipe%e7%9a%84%e5%ae%b9%e9%87%8f%e6%9c%89%e5%a4%9a%e5%a4%a7%ef%bc%8c%e5%8f%af%e4%bb%a5%e9%85%8d%e7%bd%ae%e5%90%97%ef%bc%9f%20%e5%85%88%e8%af%b4%e7%bb%93%e8%ae%ba%e5%90%a7%20fifo%e5%92%8cpipe%e7%9a%84%e5%8c%ba%e5%88%ab%20pipe%e6%98%af%e5%8c%bf%e5%90%8d%e7%ae%a1%e9%81%93%ef%bc%8c%e6%b2%a1%e6%9c%89%e5%90%8d%e5%ad%97%ef%bc%8c%e5%8f%aa%e8%83%bd%e7%94%a8%e4%ba%8e%e4%b8%a4%e4%b8%aa%e6%8b%a5%e6%9c%89pipe%e8%af%bb%e5%86%99%e4%b8%a4%e7%ab%affd%e7%9a%84%e8%bf%9b%e7%a8%8b%e9%80%9a%e4%bf%a1%ef%bc%9b%20fifo%e5%9c%a8%e6%96%87%e4%bb%b6%e7%b3%bb%e7%bb%9f%e4%b8%ad%e6%9c%89%e8%87%aa%e5%b7%b1%e7%9a%84%e5%90%8d%e7%a7%b0%ef%bc%8c%e6%93%8d%e4%bd%9cfifo%e4%b8%8e%e6%93%8d%e4%bd%9c%e6%99%ae%e9%80%9a%e6%96%87%e4%bb%b6%e5%87%a0%e6%97%a0%e5%b7%ae%e5%88%ab%ef%bc%8c%e5%8f%af%e4%bb%a5%e7%94%a8%e4%ba%8e%e4%b8%a4%e4%b8%aa%e6%b2%a1%e6%9c%89%e5%85%b3%e7%b3%bb%e7%9a%84%e8%bf%9b%e7%a8%8b%e9%97%b4%e9%80%9a%e4%bf%a1%20fifo%e5%92%8cpipe%e5%9c%a8kernel%e5%b1%82%e9%9d%a2%e4%b8%8a%e9%83%bd%e5%ae%9e%e7%8e%b0%e5%9c%a8fs%2fpipe.c%e4%b8%ad%ef%bc%8c%e6%89%80%e4%bb%a5%e6%9c%ac%e8%b4%a8%e4%b8%8a%e4%ba%8c%e8%80%85%e6%98%af%e4%b8%80%e4%b8%aa%e4%b8%9c%e8%a5%bf%e3%80%82%20pipe%e4%bd%9c%e4%b8%balinux%e6%96%87%e4%bb%b6%e7%b3%bb%e7%bb%9f%e7%9a%84%e4%b8%80%e9%83%a8%e5%88%86%ef%bc%8c%e4%b8%8eepoll%e4%b8%80%e6%a0%b7%ef%bc%8c%e9%83%bd%e6%98%af%e5%9c%a8%e5%90%91kernel%e6%b3%a8%e5%86%8c%e4%ba%86%e8%87%aa%e5%b7%b1%e7%9a%84%e6%96%87%e4%bb%b6%e7%b3%bb%e7%bb%9f%ef%bc%8c%e5%8f%af%e4%bb%a5%e4%bd%bf%e7%94%a8VFS%e6%8f%90%e4%be%9b%e7%9a%84%e9%80%9a%e7%94%a8%e6%8e%a5%e5%8f%a3%ef%bc%8c%e6%af%94%e5%a6%82open%e3%80%81read%e5%92%8cwrite%e7%ad%89%e6%93%8d%e4%bd%9c%20pipe%e7%9a%84%e5%ae%b9%e9%87%8f%e4%b8%8d%e6%98%af%e6%97%a0%e9%99%90%e5%a4%a7%e7%9a%84%ef%bc%8c%e6%97%a9%e6%9c%9flinux%e7%89%88%e6%9c%ac%ef%bc%88kernel-2.4%ef%bc%89%e4%b8%adpipe%e5%ae%b9%e9%87%8f%e5%8f%aa%e8%83%bd%e6%98%af4KB%e5%a4%a7%e5%b0%8f%ef%bc%8c%e6%96%b0%e7%89%88%e6%9c%ac%e5%8f%af%e4%bb%a5%e5%9c%a8%e8%bf%90%e8%a1%8c%e6%97%b6%e6%a0%b9%e6%8d%ae%e9%9c%80%e8%a6%81%e6%89%a9%e5%a4%a7%e5%88%b064KB%20%e6%9c%ac%e6%96%87%e4%b8%bb%e8%a6%81%e5%9f%ba%e4%ba%8elinux-2.4.20%e5%86%85%e6%a0%b8%e4%b8%ad%e7%9a%84pipe%e5%ae%9e%e7%8e%b0%e8%bf%9b%e8%a1%8c%e5%88%86%e6%9e%90%ef%bc%8c%e7%90%86%e7%94%b1%e6%98%af%e8%af%a5%e7%89%88%e6%9c%ac%e7%9a%84pipe%e5%ae%9e%e7%8e%b0%e4%b8%8e%e6%96%b0%e7%89%88%e6%9c%ackernel%e5%b9%b6%e6%b2%a1%e6%9c%89%e5%a4%aa%e5%a4%a7%e5%b7%ae%e5%88%ab%ef%bc%8c%e4%bd%86%e6%98%af%e4%bb%a3%e7%a0%81%e5%8f%af%e8%af%bb%e6%80%a7%e8%a6%81%e5%bc%ba%e5%be%88%e5%a4%9a%ef%bc%8c%e5%8f%af%e4%bb%a5%e5%bf%ab%e9%80%9f%e4%ba%86%e8%a7%a3pipe%e7%9a%84%e5%ae%9e%e9%99%85%e5%ae%9e%e7%8e%b0%ef%bc%9b%e4%bb%8e2.4.20%e5%86%85%e6%a0%b8%e4%b8%ad%e5%af%b9pipe%e7%9a%84%e6%9e%b6%e6%9e%84%e6%9c%89%e6%95%b4%e4%bd%93%e4%ba%86%e8%a7%a3%e5%90%8e%ef%bc%8c%e5%86%8d%e9%98%85%e8%af%bb%e6%96%b0%e7%89%88%e6%9c%ac%284.4.1%29%e4%b8%ad%e7%9a%84%e6%96%b0feature%ef%bc%8c%e4%bc%9a%e6%af%94%e8%be%83%e9%a1%ba%e9%81%82%e3%80%82%20pipe%e5%9c%a8fs%2fpipe.c%e4%b8%ad%e4%b8%80%e4%ba%9b%e5%87%bd%e6%95%b0%20-%20new_inode%28%29%20-%20register_filesystem%28%29%20-%20get_empty_file%20-%20get_unused_fd%28%29%20-%20do_pipe%e4%bd%9c%e4%b8%bapipe%e7%b3%bb%e7%bb%9f%e8%b0%83%e7%94%a8%e5%87%bd%e6%95%b0%ef%bc%8c%e5%9c%a8%2farch%2fi386%2fsys_i386.c%e4%b8%ad%e5%ae%9a%e4%b9%89%20-%20pipe%e7%9a%84module_init%e5%9c%a8initcall%e4%b8%ad%e8%b0%83%e7%94%a8%ef%bc%8c%e4%bd%86%e6%98%afpipe.c%e6%98%af%e7%bc%96%e8%af%91%e5%9c%a8fs.o%e4%b8%ad%e7%9a%84%ef%bc%8c%e4%bb%96%e7%9a%84module_init%e6%98%af%e5%a6%82%e4%bd%95%e8%b0%83%e7%94%a8%e8%bf%9b%e5%8e%bb%e7%9a%84%ef%bc%8c%e9%9c%80%e8%a6%81%e8%bf%9b%e4%b8%80%e6%ad%a5%e6%9f%a5%e6%89%be%20-%20struct%20dentry%e5%9c%a8include%2flinux%2fdcache.h%e4%b8%ad%e5%ae%9a%e4%b9%89%20%e5%85%b7%e4%bd%93%e5%ae%9e%e7%8e%b0%20%2a%20pipe%e6%96%87%e4%bb%b6%e7%b3%bb%e7%bb%9f%e5%88%9d%e5%a7%8b%e5%8c%96%20%2a%20%e6%b3%a8%e5%86%8cpipefs%20%2a%20register_filesystems%20%2a%20pipe%e7%b3%bb%e7%bb%9f%e8%b0%83%e7%94%a8%20%2a%20pipe%e8%b0%83%e7%94%a8do_pipe%20%2a%20do_pipe%28%29%20%2a%20f1%26amp%3bf2%20get_empty_filep%e5%88%86%e9%85%8dfilep%e6%95%b0%e6%8d%ae%e7%bb%93%e6%9e%84%20%2a%20inode%20%3d%20get_pipe_inode%28%29%e4%bb%8epipe%e6%96%87%e4%bb%b6%e7%b3%bb%e7%bb%9f%e8%8e%b7%e5%be%97inode%20%2a%20new_inode%28%29%20%2a%20pipe_new%28%29%e6%96%b0%e5%bb%bapipe%20%2a%20__get_free_pages%28GFP_USER%29%e4%b8%ba%e8%af%a5pipe%e5%88%86%e9%85%8d%e4%b8%80%e9%a1%b5%e5%86%85%e5%ad%98%ef%bc%884KB%ef%bc%89%20%2a%20inode-%26gt%3bi_pipe%20%3d%20kmalloc%28sizeof%28struct%20pipe_inde_info%29%2c%20GFP_KERNEL%29%e5%88%86%e9%85%8dpipe%e4%bf%a1%e6%81%af%e7%bb%93%e6%9e%84%20%2a%20i%26amp%3bj%20%3d%20get_unused_fd%28%29%e8%8e%b7%e5%8f%96%e4%b8%a4%e4%b8%aafd%20%2a%20dentry%20%3d%20d_alloc%28%29%e4%bb%8epipefs%e5%88%86%e9%85%8ddentry%20%2a%20d_add%28dentry%2c%20inode%29%e5%b0%86inode%e6%8f%92%e5%85%a5%e5%88%b0dentry%e4%b8%ad%20%2a%20%e5%b0%86f1%e8%ae%be%e7%bd%ae%e6%88%90O_RDONLY%ef%bc%8c%e5%b0%86f2%e8%ae%be%e7%bd%ae%e6%88%90O_WRONLY%20%2a%20%e8%bf%9b%e7%a8%8b%e7%9a%84files%e5%88%97%e8%a1%a8%e4%b8%ad%ef%bc%8cfiles%5bi%5d%20%3d%20f1%2c%20files%5bj%5d%20%3d%20f2%20%2a%20%e5%ae%9e%e7%8e%b0%e5%87%bd%e6%95%b0%20%2a%20pipe%20%2a%20pipe_read%20%2a%20pipe_write%20tips%20pipe%e4%b8%8d%e5%85%81%e8%ae%b8%e4%bd%bf%e7%94%a8seek%20%e4%bd%8e%e7%89%88%e6%9c%aclinux-2.4.20%e5%9c%a8pipe%e5%86%99%e7%9a%84%e6%97%b6%e5%80%99%e6%98%af%e5%9b%ba%e5%ae%9a%e5%a4%a7%e5%b0%8f%ef%bc%8c%e8%80%8c%e9%ab%98%e7%89%88%e6%9c%ac%e7%9a%84%e6%98%af%e4%bc%9a%e6%8c%89%e9%9c%80%e5%88%86%e9%85%8d%e7%9b%b4%e8%87%b364KB%e7%9a%84%e3%80%82%20%e9%ab%98%e7%89%88%e6%9c%ackernel%e5%86%85%e6%a0%b8%e4%b8%adsysctl%e7%9a%84%e9%85%8d%e7%bd%ae%e5%8f%82%e6%95%b0fs.pipe-max-size%20%e5%8f%af%e4%bb%a5%e8%ae%be%e7%bd%ae%e5%9b%ba%e5%ae%9a%e7%9a%84pipe%e5%a4%a7%e5%b0%8f%e3%80%82%e4%bd%86%e6%98%af%e4%b9%9f%e4%b8%8d%e8%83%bd%e8%b6%85%e8%bf%8764KB%e5%a4%a7%e5%b0%8f%ef%bc%8c%e5%8d%b3%e4%bd%bf%e9%85%8d%e7%bd%ae%e6%95%b0%e6%8d%ae%e5%a4%a7%e4%ba%8e%e8%bf%99%e4%b8%aa%e6%95%b0%e5%ad%97%ef%bc%8cpipe%e5%a4%a7%e5%b0%8f%e4%b9%9f%e4%bc%9a%e9%99%90%e5%88%b6%e5%9c%a864KB%e3%80%82%20%e6%b5%8b%e8%af%95%e4%bb%a3%e7%a0%81%20%23%21%2fbin%2fbash%20test%20%24%23%20-ge%201%20%7c%7c%20%7b%20echo%20%26quot%3busage%3a%20%240%20write-size%20%5bwait-time%5d%26quot%3b%3b%20exit%201%3b%20%7d%20test%20%24%23%20-ge%202%20%7c%7c%20set%20--%20%26quot%3b%24%40%26quot%3b%201%20bytes_written%3d%24%28%20%7b%20exec%203%26gt%3b%26amp%3b1%20%7b%20perl%20-e%20%27%20%24size%20%3d%20%24ARGV%5b0%5d%3b%20%24block%20%3d%20q%28a%29%20x%20%24size%3b%20%24num_written%20%3d%200%3b%20sub%20report%20%7b%20print%20STDERR%20%24num_written%20%2a%20%24size%2c%20qq%28%5cn%29%3b%20%7d%20report%3b%20while%20%28defined%20syswrite%20STDOUT%2c%20%24block%29%20%7b%20%24num_written%2b%2b%3b%20report%3b%20%7d%20%27%20%26quot%3b%241%26quot%3b%202%26gt%3b%26amp%3b3%20%7d%20%7c%20%28sleep%20%26quot%3b%242%26quot%3b%3b%20exec%200%26lt%3b%26amp%3b-%29%3b%20%7d%20%7c%20tail%20-1%20%29%20printf%20%26quot%3bwrite%20size%3a%20%2510d%3b%20bytes%20successfully%20before%20error%3a%20%25d%5cn%26quot%3b%20%5c%20%26quot%3b%241%26quot%3b%20%26quot%3b%24bytes_written%26quot%3b%20%2a%20%e6%b5%8b%e8%af%95%e7%bb%93%e6%9e%9c%20huang%40ThinkPad-X220%3a~%2fworkspace%2fcpp%24%20%2fbin%2fbash%20-c%20%27for%20p%20in%20%7b0..18%7d%3b%20do%20.%2fpipe.sh%20%24%28%282%20%2a%2a%20%24p%29%29%200.5%3b%20done%27%20write%20size%3a%201%3b%20bytes%20successfully%20before%20error%3a%2065536%20write%20size%3a%202%3b%20bytes%20successfully%20before%20error%3a%2065536%20write%20size%3a%204%3b%20bytes%20successfully%20before%20error%3a%2065536%20write%20size%3a%208%3b%20bytes%20successfully%20before%20error%3a%2065536%20write%20size%3a%2016%3b%20bytes%20successfully%20before%20error%3a%2065536%20write%20size%3a%2032%3b%20bytes%20successfully%20before%20error%3a%2065536%20write%20size%3a%2064%3b%20bytes%20successfully%20before%20error%3a%2065536%20write%20size%3a%20128%3b%20bytes%20successfully%20before%20error%3a%2065536%20write%20size%3a%20256%3b%20bytes%20successfully%20before%20error%3a%2065536%20write%20size%3a%20512%3b%20bytes%20successfully%20before%20error%3a%2065536%20write%20size%3a%201024%3b%20bytes%20successfully%20before%20error%3a%2065536%20write%20size%3a%202048%3b%20bytes%20successfully%20before%20error%3a%2065536%20write%20size%3a%204096%3b%20bytes%20successfully%20before%20error%3a%2065536%20write%20size%3a%208192%3b%20bytes%20successfully%20before%20error%3a%2065536%20write%20size%3a%2016384%3b%20bytes%20successfully%20before%20error%3a%2065536%20write%20size%3a%2032768%3b%20bytes%20successfully%20before%20error%3a%2065536%20write%20size%3a%2065536%3b%20bytes%20successfully%20before%20error%3a%2065536%20write%20size%3a%20131072%3b%20bytes%20successfully%20before%20error%3a%200%20write%20size%3a%20262144%3b%20bytes%20successfully%20before%20error%3a%200%20%2a%20%e5%86%85%e6%a0%b8%e4%b8%ad64KB%e5%a4%a7%e5%b0%8f%e7%9a%84%e9%99%90%e5%88%b6%e5%9c%a8%e5%93%aa%e9%87%8c%e8%ae%be%e7%bd%ae%e7%9a%84%ef%bc%9f%28TO%20DO%29%20%2a%20%e5%8f%aa%e6%9c%89%e5%9c%a8%e9%ab%98%e7%89%88%e6%9c%ac%e7%9a%84pipe%e5%ae%9e%e7%8e%b0%e4%b8%ad%e6%89%8d%e6%9c%8964KB%e5%a4%a7%e5%b0%8f%ef%bc%8c%e4%bd%8e%e7%89%88%e6%9c%ac%e9%83%bd%e6%98%af4KB%e7%9a%84%e3%80%82%20%2a%20ulimit%20-a%20%e7%9a%84%e7%bb%93%e6%9e%9c%e4%b8%ad%ef%bc%8c%26quot%3bpipe%20size%20%28512%20bytes%2c%20-p%29%208%26quot%3b%ef%bc%8c%e8%a1%a8%e7%a4%ba%e4%b8%80%e4%b8%aapipe%e6%8b%a5%e6%9c%898%e4%b8%aa512KB%e7%9a%84buffer%ef%bc%8c%e6%80%bb%e5%85%b1%e6%98%af4KB%20%2a%20%e5%9c%a8include%2flinux%2ffs_pipe_i.h%e4%b8%ad%ef%bc%8c%23define%20PIPE_DEF_BUFFERS%2016%2c%20%e8%bf%99%e9%87%8c%e6%98%af%5b%e6%8c%89buffer%e7%9a%84%e6%95%b0%e9%87%8f%e5%88%86%e9%85%8d%e7%9a%84%5d%28http%3a%2f%2fhome.gna.org%2fpysfst%2ftests%2fpipe-limit.html%29%e3%80%82%20%2a%20%e5%9c%a8fs%2fpipe.c%e4%b8%ad%ef%bc%8cpipe_write%e5%92%8cpipe_read%e6%98%af%e5%9c%a8%e8%bf%90%e8%a1%8c%e6%97%b6%e6%8c%89%e9%a1%b5%e5%a4%a7%e5%b0%8f%e5%88%86%e9%85%8d%e7%9a%84%20%2a%20sysctl%e4%b8%adfs.max_pipe_size%e7%9a%84%e8%ae%be%e7%bd%ae%ef%bc%8cfs.pipe-max-size%20%3d%201048576%ef%bc%8c%e5%8f%88%e4%bc%9a%e8%b5%b7%e4%bb%80%e4%b9%88%e4%bd%9c%e7%94%a8%20%e5%87%bd%e6%95%b0%e5%88%86%e6%9e%90%20init_pipe_fs%e5%90%91%e6%96%87%e4%bb%b6%e7%b3%bb%e7%bb%9f%e6%b3%a8%e5%86%8cpipe%e7%bb%84%e4%bb%b6%20static%20int%20__init%20init_pipe_fs%28void%29%20%7b%20int%20err%20%3d%20register_filesystem%28%26amp%3bpipe_fs_type%29%3b%20if%20%28%21err%29%20%7b%20pipe_mnt%20%3d%20kern_mount%28%26amp%3bpipe_fs_type%29%3b%20err%20%3d%20PTR_ERR%28pipe_mnt%29%3b%20if%20%28IS_ERR%28pipe_mnt%29%29%20unregister_filesystem%28%26amp%3bpipe_fs_type%29%3b%20else%20err%20%3d%200%3b%20%7d%20return%20err%3b%20%7d%20static%20DECLARE_FSTYPE%28pipe_fs_type%2c%20%26quot%3bpipefs%26quot%3b%2c%20pipefs_read_super%2c%20FS_NOMOUNT%29%3b%20%23define%20DECLARE_FSTYPE%28var%2ctype%2cread%2cflags%29%20%5c%20struct%20file_system_type%20var%20%3d%20%7b%20%5c%20name%3a%20type%2c%20%5c%20read_super%3a%20read%2c%20%5c%20fs_flags%3a%20flags%2c%20%5c%20owner%3a%20THIS_MODULE%2c%20%5c%20%7d%20%2a%20pipe%e6%ba%90%e7%a0%81%ef%bc%882.4%e7%9a%84%e5%ae%9e%e7%8e%b0%e4%b8%ad%e5%ae%9e%e5%9c%a8%e6%b2%a1%e4%bb%80%e4%b9%88%e5%8f%af%e8%ae%b2%e7%9a%84%ef%bc%8c%e6%af%94%e8%be%83%e6%9c%89%e4%bb%b7%e5%80%bc%e7%9a%84%e6%98%afpipe_write%e5%92%8cpipe_read%e4%b8%ad%e5%a4%84%e7%90%86%e7%bc%93%e5%86%b2%e9%98%9f%e5%88%97%e6%ba%90%e7%a0%81%e5%8f%af%e4%bb%a5%e5%8f%82%e8%80%83%ef%bc%89%20%2f%2a%20%2a%20We%20use%20a%20start%2blen%20construction%2c%20which%20provides%20full%20use%20of%20the%20%2a%20allocated%20memory...." class="popup">
              <span class="icon">
                  <svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="28px" height="28px" viewBox="0 0 28 28" enable-background="new 0 0 28 28" xml:space="preserve">
                      <path d="M25.424,15.887v8.447h-4.896v-7.882c0-1.979-0.709-3.331-2.48-3.331c-1.354,0-2.158,0.911-2.514,1.803 c-0.129,0.315-0.162,0.753-0.162,1.194v8.216h-4.899c0,0,0.066-13.349,0-14.731h4.899v2.088c-0.01,0.016-0.023,0.032-0.033,0.048 h0.033V11.69c0.65-1.002,1.812-2.435,4.414-2.435C23.008,9.254,25.424,11.361,25.424,15.887z M5.348,2.501 c-1.676,0-2.772,1.092-2.772,2.539c0,1.421,1.066,2.538,2.717,2.546h0.032c1.709,0,2.771-1.132,2.771-2.546 C8.054,3.593,7.019,2.501,5.343,2.501H5.348z M2.867,24.334h4.897V9.603H2.867V24.334z"/>
                  </svg>
              </span>
              <span class="text">LinkedIn</span>
          </a>
      </li>
      <li class="tumblr">
					<script>
						document.write('<a href="http://www.tumblr.com/share?v=3&amp;u=' + encodeURIComponent('https:\/\/bg2bkk.github.io\/post\/pipe%E5%9C%A8%E5%86%85%E6%A0%B8%E4%B8%AD%E7%9A%84%E5%AE%9E%E7%8E%B0\/') + '&amp;t=pipe在内核中的实现" class="popup">');
					</script>
              <span class="icon">
                  <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" x="0px" y="0px" width="28px" height="28px" viewBox="0 0 28 28" enable-background="new 0 0 28 28" xml:space="preserve">
											<path d="M18.02 21.842c-2.029 0.052-2.422-1.396-2.439-2.446v-7.294h4.729V7.874h-4.71V1.592c0 0-3.653 0-3.714 0 s-0.167 0.053-0.182 0.186c-0.218 1.935-1.144 5.33-4.988 6.688v3.637h2.927v7.677c0 2.8 1.7 6.7 7.3 6.6 c1.863-0.03 3.934-0.795 4.392-1.453l-1.22-3.539C19.595 21.6 18.7 21.8 18 21.842z"/>
									</svg>
              </span>
              <span class="text">Tumblr</span>
          <script>document.write('</a>');</script>
      </li>
      <li class="reddit">
          <a href="http://www.reddit.com/submit?url=https://bg2bkk.github.io/post/pipe%E5%9C%A8%E5%86%85%E6%A0%B8%E4%B8%AD%E7%9A%84%E5%AE%9E%E7%8E%B0/">
              <span class="icon">
                  <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" x="0px" y="0px" width="28px" height="28px" viewBox="0 0 28 28" enable-background="new 0 0 28 28" xml:space="preserve">
											<g>
													<path d="M11.794 15.316c0-1.029-0.835-1.895-1.866-1.895c-1.03 0-1.893 0.865-1.893 1.895s0.863 1.9 1.9 1.9 C10.958 17.2 11.8 16.3 11.8 15.316z"/>
													<path d="M18.1 13.422c-1.029 0-1.895 0.864-1.895 1.895c0 1 0.9 1.9 1.9 1.865c1.031 0 1.869-0.836 1.869-1.865 C19.969 14.3 19.1 13.4 18.1 13.422z"/>
													<path d="M17.527 19.791c-0.678 0.678-1.826 1.006-3.514 1.006c-0.004 0-0.009 0-0.014 0c-0.004 0-0.01 0-0.015 0 c-1.686 0-2.834-0.328-3.51-1.005c-0.264-0.265-0.693-0.265-0.958 0c-0.264 0.265-0.264 0.7 0 1 c0.943 0.9 2.4 1.4 4.5 1.402c0.005 0 0 0 0 0c0.005 0 0 0 0 0c2.066 0 3.527-0.459 4.47-1.402 c0.265-0.264 0.265-0.693 0.002-0.958C18.221 19.5 17.8 19.5 17.5 19.791z"/>
													<path d="M27.707 13.267c0-1.785-1.453-3.237-3.236-3.237c-0.793 0-1.518 0.287-2.082 0.761c-2.039-1.295-4.646-2.069-7.438-2.219 l1.483-4.691l4.062 0.956c0.071 1.4 1.3 2.6 2.7 2.555c1.488 0 2.695-1.208 2.695-2.695C25.881 3.2 24.7 2 23.2 2 c-1.059 0-1.979 0.616-2.42 1.508l-4.633-1.091c-0.344-0.081-0.693 0.118-0.803 0.455l-1.793 5.7 C10.548 8.6 7.7 9.4 5.6 10.75C5.006 10.3 4.3 10 3.5 10.029c-1.785 0-3.237 1.452-3.237 3.2 c0 1.1 0.6 2.1 1.4 2.69c-0.04 0.272-0.061 0.551-0.061 0.831c0 2.3 1.3 4.4 3.7 5.9 c2.299 1.5 5.3 2.3 8.6 2.325c3.228 0 6.271-0.825 8.571-2.325c2.387-1.56 3.7-3.66 3.7-5.917 c0-0.26-0.016-0.514-0.051-0.768C27.088 15.5 27.7 14.4 27.7 13.267z M23.186 3.355c0.74 0 1.3 0.6 1.3 1.3 c0 0.738-0.6 1.34-1.34 1.34s-1.342-0.602-1.342-1.34C21.844 4 22.4 3.4 23.2 3.355z M1.648 13.3 c0-1.038 0.844-1.882 1.882-1.882c0.31 0 0.6 0.1 0.9 0.209c-1.049 0.868-1.813 1.861-2.26 2.9 C1.832 14.2 1.6 13.8 1.6 13.267z M21.773 21.57c-2.082 1.357-4.863 2.105-7.831 2.105c-2.967 0-5.747-0.748-7.828-2.105 c-1.991-1.301-3.088-3-3.088-4.782c0-1.784 1.097-3.484 3.088-4.784c2.081-1.358 4.861-2.106 7.828-2.106 c2.967 0 5.7 0.7 7.8 2.106c1.99 1.3 3.1 3 3.1 4.784C24.859 18.6 23.8 20.3 21.8 21.57z M25.787 14.6 c-0.432-1.084-1.191-2.095-2.244-2.977c0.273-0.156 0.59-0.245 0.928-0.245c1.035 0 1.9 0.8 1.9 1.9 C26.354 13.8 26.1 14.3 25.8 14.605z"/>
											</g>
									</svg>
              </span>
              <span class="text">Reddit</span>
          </a>
      </li>
      <li class="googleplus">
          <a href="https://plus.google.com/share?url=https://bg2bkk.github.io/post/pipe%E5%9C%A8%E5%86%85%E6%A0%B8%E4%B8%AD%E7%9A%84%E5%AE%9E%E7%8E%B0/" class="popup">
              <span class="icon">
                  <svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="28px" height="28px" viewBox="0 0 28 28" enable-background="new 0 0 28 28" xml:space="preserve">
                      <g>
                          <path d="M14.703,15.854l-1.219-0.948c-0.372-0.308-0.88-0.715-0.88-1.459c0-0.748,0.508-1.223,0.95-1.663 c1.42-1.119,2.839-2.309,2.839-4.817c0-2.58-1.621-3.937-2.399-4.581h2.097l2.202-1.383h-6.67c-1.83,0-4.467,0.433-6.398,2.027 C3.768,4.287,3.059,6.018,3.059,7.576c0,2.634,2.022,5.328,5.604,5.328c0.339,0,0.71-0.033,1.083-0.068 c-0.167,0.408-0.336,0.748-0.336,1.324c0,1.04,0.551,1.685,1.011,2.297c-1.524,0.104-4.37,0.273-6.467,1.562 c-1.998,1.188-2.605,2.916-2.605,4.137c0,2.512,2.358,4.84,7.289,4.84c5.822,0,8.904-3.223,8.904-6.41 c0.008-2.327-1.359-3.489-2.829-4.731H14.703z M10.269,11.951c-2.912,0-4.231-3.765-4.231-6.037c0-0.884,0.168-1.797,0.744-2.511 c0.543-0.679,1.489-1.12,2.372-1.12c2.807,0,4.256,3.798,4.256,6.242c0,0.612-0.067,1.694-0.845,2.478 c-0.537,0.55-1.438,0.948-2.295,0.951V11.951z M10.302,25.609c-3.621,0-5.957-1.732-5.957-4.142c0-2.408,2.165-3.223,2.911-3.492 c1.421-0.479,3.25-0.545,3.555-0.545c0.338,0,0.52,0,0.766,0.034c2.574,1.838,3.706,2.757,3.706,4.479 c-0.002,2.073-1.736,3.665-4.982,3.649L10.302,25.609z"/>
                          <polygon points="23.254,11.89 23.254,8.521 21.569,8.521 21.569,11.89 18.202,11.89 18.202,13.604 21.569,13.604 21.569,17.004 23.254,17.004 23.254,13.604 26.653,13.604 26.653,11.89"/>
                      </g>
                  </svg>
              </span>
              <span class="text">Google+</span>
          </a>
      </li>
      <li class="pinterest">
          <script>
						var imgurl = "https:\/\/bg2bkk.github.io\/logo.png";
						var firstimg = document.getElementsByClassName("post")[0].getElementsByTagName("img")[0];
						if (firstimg !== undefined) {
							imgurl = firstimg.src;
						}
						document.write('<a href="http://pinterest.com/pin/create/button/?url=https:\/\/bg2bkk.github.io\/post\/pipe%E5%9C%A8%E5%86%85%E6%A0%B8%E4%B8%AD%E7%9A%84%E5%AE%9E%E7%8E%B0\/&amp;media=' + imgurl + '&amp;description=pipe在内核中的实现" class="popup">');
					</script>
              <span class="icon">
                  <svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="28px" height="28px" viewBox="0 0 28 28" enable-background="new 0 0 28 28" xml:space="preserve">
		                  <path d="M14.021,1.57C6.96,1.57,1.236,7.293,1.236,14.355c0,7.062,5.724,12.785,12.785,12.785c7.061,0,12.785-5.725,12.785-12.785 C26.807,7.294,21.082,1.57,14.021,1.57z M15.261,18.655c-1.161-0.09-1.649-0.666-2.559-1.219c-0.501,2.626-1.113,5.145-2.925,6.458 c-0.559-3.971,0.822-6.951,1.462-10.116c-1.093-1.84,0.132-5.545,2.438-4.632c2.837,1.123-2.458,6.842,1.099,7.557 c3.711,0.744,5.227-6.439,2.925-8.775c-3.325-3.374-9.678-0.077-8.897,4.754c0.19,1.178,1.408,1.538,0.489,3.168 C7.165,15.378,6.53,13.7,6.611,11.462c0.131-3.662,3.291-6.227,6.46-6.582c4.007-0.448,7.771,1.474,8.29,5.239 c0.579,4.255-1.816,8.865-6.102,8.533L15.261,18.655z"/>
                  </svg>
              </span>
              <span class="text">Pinterest</span>
          <script>document.write('</a>');</script>
      </li>
      <li class="pocket">
          <a href="https://getpocket.com/save?url=https://bg2bkk.github.io/post/pipe%E5%9C%A8%E5%86%85%E6%A0%B8%E4%B8%AD%E7%9A%84%E5%AE%9E%E7%8E%B0/"  class="popup">
              <span class="icon">
                  <svg width="32px" height="28px" viewBox="0 0 32 28" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:sketch="http://www.bohemiancoding.com/sketch/ns">
                      <path d="M28.7817528,0.00172488695 C30.8117487,0.00431221738 31.9749312,1.12074529 31.9644402,3.10781507 C31.942147,6.67703739 32.1336065,10.2669583 31.8057648,13.8090137 C30.7147076,25.5813672 17.2181194,31.8996281 7.20714461,25.3808491 C2.71833574,22.4571656 0.196577202,18.3122624 0.0549495772,12.9357897 C-0.0342233715,9.5774348 0.00642900214,6.21519891 0.0300336062,2.85555035 C0.0405245414,1.1129833 1.21157517,0.0146615391 3.01995012,0.00819321302 C7.34746087,-0.00603710433 11.6775944,0.00431221738 16.0064164,0.00172488695 C20.2644248,0.00172488695 24.5237444,-0.00215610869 28.7817528,0.00172488695 L28.7817528,0.00172488695 Z M8.64885184,7.85611511 C7.38773662,7.99113854 6.66148108,8.42606978 6.29310958,9.33228474 C5.90114134,10.2969233 6.17774769,11.1421181 6.89875951,11.8276216 C9.35282156,14.161969 11.8108164,16.4924215 14.2976518,18.7943114 C15.3844131,19.7966007 16.5354102,19.7836177 17.6116843,18.7813283 C20.0185529,16.5495467 22.4070683,14.2982907 24.7824746,12.0327533 C25.9845979,10.8850542 26.1012707,9.56468083 25.1469132,8.60653379 C24.1361858,7.59255976 22.8449191,7.6743528 21.5890476,8.85191291 C19.9936451,10.3488554 18.3680912,11.8172352 16.8395462,13.3777945 C16.1342655,14.093159 15.7200114,14.0048744 15.0566806,13.3440386 C13.4599671,11.7484252 11.8081945,10.2060421 10.1262706,8.70001155 C9.65564653,8.27936164 9.00411403,8.05345704 8.64885184,7.85611511 L8.64885184,7.85611511 L8.64885184,7.85611511 Z"></path>
                  </svg>
              </span>
              <span class="text">Pocket</span>
          </a>
      </li>
  </ul>
</div>

    <div itemprop="author" itemscope itemtype="http://schema.org/Person">
  <h5>about the author</h5>
  <section>

	<p>如果关于本文您有兴趣，我们可以进一步探讨、交流和学习。我的email是 bg2bkk # gmail.com. 欢迎交流</p>
  </section>
</div>

    <div id="comments">
    
    
    
    
</div>

</article>

</main>
		<footer id="footer">
			<section id="footer-message">&copy; BG2BKK Site. All rights reserved. Powered by <a href="http://gohugo.io" target="_blank">Hugo</a>. <a href="https://github.com/kathyqian/crisp-ghost-theme" target="_blank">Crisp</a> theme by <a href="http://kathyqian.com" target="_blank">Kathy Qian</a>.</section>
		</footer>

    <script>
      (function(c,f){asyncLoader=function(i,h){i.foreach(function(k,j){e(j,d(j),h)});if(typeof h.callback=="function"){var g=setInterval(function(){if(f.readyState==="complete"){clearInterval(g);h.callback()}},10)}};var d=function(g){var h=g.split(".");return h[h.length-1]},e=function(h,i,g){switch(i){case"js":a(h,g);break;case"css":b(h);break;default:break}},a=function(i,h){var g=document.createElement("script");g.type="text/javascript";g.async=true;g.src=i;document.getElementsByTagName("head")[0].appendChild(g)},b=function(g){var h=document.createElement("link");h.type="text/css";h.rel="stylesheet";h.href=g;document.getElementsByTagName("head")[0].appendChild(h)};Array.prototype.foreach=function(h){for(var g=0;g<this.length;g++){h(g,this[g])}}})(this,document);

      var WebFontConfig={google:{families:["Open Sans:300italic,700italic,300,700","Bree+Serif"]}};
      asyncLoader([
        "//netdna.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.css",
        "//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js",
        "//cdnjs.cloudflare.com/ajax/libs/webfont/1.5.16/webfontloader.js",
        "//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.5/highlight.min.js"
      ],{
        callback:function(){
          asyncLoader([
            "https:\/\/bg2bkk.github.io\/css/rrssb.css",
            "https:\/\/bg2bkk.github.io\/js/gist.min.js", 
            "https:\/\/bg2bkk.github.io\/js/rrssb.min.js",
            "//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.5/styles/default.min.css"
          ], { callback:function() {
              hljs.initHighlighting();
          }});
        }
      });
    </script>
	
	</body>
</html>

<!DOCTYPE html>
<html lang="" dir="ltr">
    <head><meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'><meta name='description' content='nrf51822的dfu与别的芯片的空中升级几乎没有差别，以ESP8266为例，本次启动是从启动点bank0启动，空中升级的过程是，从远程网络服务器获取固件并写在bank1中，校验成功后设置下次启动点为bank1，重启后升级成功；nrf51822有点不同的是，空中升级通过ble获取固件并写入flash的bank1后，校验成功会擦除bank0，将bank1内容复制到bank0中，然后重启。
我的芯片是nrf51822 QFAA，16KB Ram，256KB Flash，使用SDK10。nrf51822启动时，bootloader检查是否进入dfu流程中。bootloader采用 SDK_10_PATH/examples/dfu/bootloader/pca10028/dual_bank_ble_s110，该例程启动时读取button4状态，如果被按下，说明需要进入dfu状态，在讯连的板子上没有button4，所以改用button0。
  Keil MDK实现空中升级
  如上链接所示的过程写的比较详细
 准备工作  softdevice: SDK_10_PATH/components/softdevice/s110/hex/s110_nrf51_8.0.0_softdevice.hex bootloader: SDK_10_PATH/examples/dfu/bootloader/pca10028/dual_bank_ble_s110 ble application: SDK_10_PATH/examples/ble_peripheral/ble_app_uart nrf-Connect，主要使用hex2bin.exe和怎样制作DFU初始化包 Keil MDK4/5 Master Control Panel，采用最新版3.10.0.14  制作升级包        制作bootloader，采用dual_bank_ble_s110
 dual_bank_ble_s110的flash和ram布局  nrf51822 QFAC 32KB Ram 256 KB Flash  flash  start 0x3C000 length 0x3C00   ram  ram1  start 0x20002C00 length 0x5380   ram2  start 0x20007F80 length 0x80 NoInit       nrf51822 QFAA 16KB Ram 256 KB Flash  flash  start 0x3C000 length 0x3C00   ram  ram1  start 0x20002C00 length 0x1380   ram2  start 0x20001F80 length 0x80 NoInit         烧写bootloader  首先烧写　softdevice s110，采用nrfgo studio写入s110.'>
<title>ble_nrf51822_dfu_空中升级</title>

<link rel='canonical' href='https://bg2bkk.github.io/p/ble_nrf51822_dfu_%E7%A9%BA%E4%B8%AD%E5%8D%87%E7%BA%A7/'>

<link rel="stylesheet" href="/scss/style.min.3b122f5b6a7023e613be9affad843eaceacf4a3383edd177ce41e35501998968.css"><meta property='og:title' content='ble_nrf51822_dfu_空中升级'>
<meta property='og:description' content='nrf51822的dfu与别的芯片的空中升级几乎没有差别，以ESP8266为例，本次启动是从启动点bank0启动，空中升级的过程是，从远程网络服务器获取固件并写在bank1中，校验成功后设置下次启动点为bank1，重启后升级成功；nrf51822有点不同的是，空中升级通过ble获取固件并写入flash的bank1后，校验成功会擦除bank0，将bank1内容复制到bank0中，然后重启。
我的芯片是nrf51822 QFAA，16KB Ram，256KB Flash，使用SDK10。nrf51822启动时，bootloader检查是否进入dfu流程中。bootloader采用 SDK_10_PATH/examples/dfu/bootloader/pca10028/dual_bank_ble_s110，该例程启动时读取button4状态，如果被按下，说明需要进入dfu状态，在讯连的板子上没有button4，所以改用button0。
  Keil MDK实现空中升级
  如上链接所示的过程写的比较详细
 准备工作  softdevice: SDK_10_PATH/components/softdevice/s110/hex/s110_nrf51_8.0.0_softdevice.hex bootloader: SDK_10_PATH/examples/dfu/bootloader/pca10028/dual_bank_ble_s110 ble application: SDK_10_PATH/examples/ble_peripheral/ble_app_uart nrf-Connect，主要使用hex2bin.exe和怎样制作DFU初始化包 Keil MDK4/5 Master Control Panel，采用最新版3.10.0.14  制作升级包        制作bootloader，采用dual_bank_ble_s110
 dual_bank_ble_s110的flash和ram布局  nrf51822 QFAC 32KB Ram 256 KB Flash  flash  start 0x3C000 length 0x3C00   ram  ram1  start 0x20002C00 length 0x5380   ram2  start 0x20007F80 length 0x80 NoInit       nrf51822 QFAA 16KB Ram 256 KB Flash  flash  start 0x3C000 length 0x3C00   ram  ram1  start 0x20002C00 length 0x1380   ram2  start 0x20001F80 length 0x80 NoInit         烧写bootloader  首先烧写　softdevice s110，采用nrfgo studio写入s110.'>
<meta property='og:url' content='https://bg2bkk.github.io/p/ble_nrf51822_dfu_%E7%A9%BA%E4%B8%AD%E5%8D%87%E7%BA%A7/'>
<meta property='og:site_name' content='Bg2bkk Site'>
<meta property='og:type' content='article'><meta property='article:section' content='Post' /><meta property='article:published_time' content='2016-07-20T15:31:44&#43;08:00'/><meta property='article:modified_time' content='2016-07-20T15:31:44&#43;08:00'/>
<meta name="twitter:title" content="ble_nrf51822_dfu_空中升级">
<meta name="twitter:description" content="nrf51822的dfu与别的芯片的空中升级几乎没有差别，以ESP8266为例，本次启动是从启动点bank0启动，空中升级的过程是，从远程网络服务器获取固件并写在bank1中，校验成功后设置下次启动点为bank1，重启后升级成功；nrf51822有点不同的是，空中升级通过ble获取固件并写入flash的bank1后，校验成功会擦除bank0，将bank1内容复制到bank0中，然后重启。
我的芯片是nrf51822 QFAA，16KB Ram，256KB Flash，使用SDK10。nrf51822启动时，bootloader检查是否进入dfu流程中。bootloader采用 SDK_10_PATH/examples/dfu/bootloader/pca10028/dual_bank_ble_s110，该例程启动时读取button4状态，如果被按下，说明需要进入dfu状态，在讯连的板子上没有button4，所以改用button0。
  Keil MDK实现空中升级
  如上链接所示的过程写的比较详细
 准备工作  softdevice: SDK_10_PATH/components/softdevice/s110/hex/s110_nrf51_8.0.0_softdevice.hex bootloader: SDK_10_PATH/examples/dfu/bootloader/pca10028/dual_bank_ble_s110 ble application: SDK_10_PATH/examples/ble_peripheral/ble_app_uart nrf-Connect，主要使用hex2bin.exe和怎样制作DFU初始化包 Keil MDK4/5 Master Control Panel，采用最新版3.10.0.14  制作升级包        制作bootloader，采用dual_bank_ble_s110
 dual_bank_ble_s110的flash和ram布局  nrf51822 QFAC 32KB Ram 256 KB Flash  flash  start 0x3C000 length 0x3C00   ram  ram1  start 0x20002C00 length 0x5380   ram2  start 0x20007F80 length 0x80 NoInit       nrf51822 QFAA 16KB Ram 256 KB Flash  flash  start 0x3C000 length 0x3C00   ram  ram1  start 0x20002C00 length 0x1380   ram2  start 0x20001F80 length 0x80 NoInit         烧写bootloader  首先烧写　softdevice s110，采用nrfgo studio写入s110.">
    </head>
    <body class="
    article-page
    ">
    <script>
        (function() {
            const colorSchemeKey = 'StackColorScheme';
            if(!localStorage.getItem(colorSchemeKey)){
                localStorage.setItem(colorSchemeKey, "auto");
            }
        })();
    </script><script>
    (function() {
        const colorSchemeKey = 'StackColorScheme';
        const colorSchemeItem = localStorage.getItem(colorSchemeKey);
        const supportDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches === true;

        if (colorSchemeItem == 'dark' || colorSchemeItem === 'auto' && supportDarkMode) {
            

            document.documentElement.dataset.scheme = 'dark';
        } else {
            document.documentElement.dataset.scheme = 'light';
        }
    })();
</script>
<div class="container main-container flex on-phone--column compact"><aside class="sidebar left-sidebar sticky ">
    <button class="hamburger hamburger--spin" type="button" id="toggle-menu" aria-label="Toggle Menu">
        <span class="hamburger-box">
            <span class="hamburger-inner"></span>
        </span>
    </button>

    <header>
        
            
            <figure class="site-avatar">
                <a href="/">
                
                    
                    
                    
                        
                        <img src="/img/avatar_hu9dfb7228514195dbb950046570d90a5c_100216_300x0_resize_q75_box.jpg" width="300"
                            height="221" class="site-logo" loading="lazy" alt="Avatar">
                    
                
                </a>
                
            </figure>
            
        
        
        <div class="site-meta">
            <h1 class="site-name"><a href="/">Bg2bkk Site</a></h1>
            <h2 class="site-description"></h2>
        </div>
    </header><ol class="menu" id="main-menu">
        
        
        

        <li >
            <a href='/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <polyline points="5 12 3 12 12 3 21 12 19 12" />
  <path d="M5 12v7a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-7" />
  <path d="M9 21v-6a2 2 0 0 1 2 -2h2a2 2 0 0 1 2 2v6" />
</svg>



                
                <span>Home</span>
            </a>
        </li>
        
        

        <li >
            <a href='/about/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="7" r="4" />
  <path d="M6 21v-2a4 4 0 0 1 4 -4h4a4 4 0 0 1 4 4v2" />
</svg>



                
                <span>About</span>
            </a>
        </li>
        
        

        <li >
            <a href='/archives/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <rect x="3" y="4" width="18" height="4" rx="2" />
  <path d="M5 8v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-10" />
  <line x1="10" y1="12" x2="14" y2="12" />
</svg>



                
                <span>Archives</span>
            </a>
        </li>
        
        

        <li >
            <a href='/search/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="10" cy="10" r="7" />
  <line x1="21" y1="21" x2="15" y2="15" />
</svg>



                
                <span>Search</span>
            </a>
        </li>
        

        <div class="menu-bottom-section">
            
            
                <li id="dark-mode-toggle">
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="8" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="16" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                    <span>Dark Mode</span>
                </li>
            
        </div>
    </ol>
</aside>

    

            <main class="main full-width">
    <article class="main-article">
    <header class="article-header">

    <div class="article-details">
    

    <div class="article-title-wrapper">
        <h2 class="article-title">
            <a href="/p/ble_nrf51822_dfu_%E7%A9%BA%E4%B8%AD%E5%8D%87%E7%BA%A7/">ble_nrf51822_dfu_空中升级</a>
        </h2>
    
        
    </div>

    
    <footer class="article-time">
        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M11.795 21h-6.795a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v4" />
  <circle cx="18" cy="18" r="4" />
  <path d="M15 3v4" />
  <path d="M7 3v4" />
  <path d="M3 11h16" />
  <path d="M18 16.496v1.504l1 1" />
</svg>
                <time class="article-time--published">Jul 20, 2016</time>
            </div>
        

    
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <polyline points="12 7 12 12 15 15" />
</svg>



                <time class="article-time--reading">
                    3 minute read
                </time>
            </div>
        
    </footer>
    

    
</div>

</header>

    <section class="article-content">
    
    
    <p>nrf51822的dfu与别的芯片的空中升级几乎没有差别，以ESP8266为例，本次启动是从启动点bank0启动，空中升级的过程是，从远程网络服务器获取固件并写在bank1中，校验成功后设置下次启动点为bank1，重启后升级成功；nrf51822有点不同的是，空中升级通过ble获取固件并写入flash的bank1后，校验成功会擦除bank0，将bank1内容复制到bank0中，然后重启。</p>
<p>我的芯片是nrf51822 QFAA，16KB Ram，256KB Flash，使用SDK10。nrf51822启动时，bootloader检查是否进入dfu流程中。bootloader采用 SDK_10_PATH/examples/dfu/bootloader/pca10028/dual_bank_ble_s110，该例程启动时读取button4状态，如果被按下，说明需要进入dfu状态，在讯连的板子上没有button4，所以改用button0。</p>
<ul>
<li>
<p><a class="link" href="http://blog.csdn.net/a369000753/article/details/51153882"  target="_blank" rel="noopener"
    >Keil MDK实现空中升级</a></p>
<ul>
<li>
<p>如上链接所示的过程写的比较详细</p>
<ul>
<li>准备工作
<ul>
<li>softdevice: SDK_10_PATH/components/softdevice/s110/hex/s110_nrf51_8.0.0_softdevice.hex</li>
<li>bootloader: SDK_10_PATH/examples/dfu/bootloader/pca10028/dual_bank_ble_s110</li>
<li>ble application: SDK_10_PATH/examples/ble_peripheral/ble_app_uart</li>
<li><a class="link" href="https://github.com/NordicSemiconductor/Android-nRF-Connect"  target="_blank" rel="noopener"
    >nrf-Connect</a>，主要使用hex2bin.exe和<a class="link" href="https://raw.githubusercontent.com/BG2BKK/githubio/master/static/How%20to%20generate%20the%20INIT%20file%20for%20DFU.pdf"  target="_blank" rel="noopener"
    >怎样制作DFU初始化包</a></li>
<li>Keil MDK4/5</li>
<li>Master Control Panel，采用最新版3.10.0.14
<ul>
<li>制作升级包</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p>制作bootloader，采用dual_bank_ble_s110</p>
<ul>
<li>dual_bank_ble_s110的flash和ram布局
<ul>
<li>nrf51822 QFAC 32KB Ram 256 KB Flash
<ul>
<li>flash
<ul>
<li>start 0x3C000</li>
<li>length 0x3C00</li>
</ul>
</li>
<li>ram
<ul>
<li>ram1
<ul>
<li>start 0x20002C00</li>
<li>length 0x5380</li>
</ul>
</li>
<li>ram2
<ul>
<li>start 0x20007F80</li>
<li>length 0x80</li>
<li>NoInit</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>nrf51822 QFAA 16KB Ram 256 KB Flash
<ul>
<li>flash
<ul>
<li>start 0x3C000</li>
<li>length 0x3C00</li>
</ul>
</li>
<li>ram
<ul>
<li>ram1
<ul>
<li>start 0x20002C00</li>
<li>length 0x1380</li>
</ul>
</li>
<li>ram2
<ul>
<li>start 0x20001F80</li>
<li>length 0x80</li>
<li>NoInit</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>烧写bootloader
<ul>
<li>首先烧写　softdevice s110，采用nrfgo studio写入s110.hex
<ul>
<li>SDK_10_PATH/components/softdevice/s110/hex/s110_nrf51_8.0.0_softdevice.hex</li>
</ul>
</li>
<li>烧写bootloader</li>
<li>重启，可以在手机的nrf Connect或者nrf Beacon看到DfuTarg，说明bootloader写成功；由于目前只有bootloader没有app，所以bootloader默认进入DFU状态</li>
</ul>
</li>
</ul>
</li>
<li>
<p>开发应用程序和升级包</p>
<ul>
<li>应用程序可以在ble_peripheral中找，我习惯用ble_app_uart</li>
<li>ble_app_uart的flash和ram布局
<ul>
<li>nrf51822 QFAC 32KB Ram 256 KB Flash
<ul>
<li>flash
<ul>
<li>start 0x18000</li>
<li>length 0x28000</li>
</ul>
</li>
<li>ram
<ul>
<li>start 0x20002000</li>
<li>length 0x4000</li>
</ul>
</li>
</ul>
</li>
<li>nrf51822 QFAA 16KB Ram 256 KB Flash
<ul>
<li>flash
<ul>
<li>start 0x18000</li>
<li>length 0x28000</li>
</ul>
</li>
<li>ram
<ul>
<li>start 0x20002000</li>
<li>length 0x2000</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>生成应用程序bin文件
<ul>
<li>MDK编译生成hex文件，伴有axf文件</li>
<li>生成bin文件的两种方式
<ul>
<li>keil mdk fromelf.exe
<ul>
<li>PATH: <code> C:\Keil\ARM\ARMCC\bin\fromelf.exe</code></li>
<li>cmd: <code> fromelf.exe --bin --output outfile.bin infile.axf</code></li>
</ul>
</li>
<li>Android-nRF-Connect的hex2bin方式
<ul>
<li><code> git clone https://github.com/NordicSemiconductor/Android-nRF-Connect</code></li>
<li><code> path/Android-nRF-Connect/init packet handling/hex2bin.exe _build/nrf51422_xxac_s110.hex</code> 就可以生成bin文件</li>
</ul>
</li>
<li>推荐方式为后者，并借助keil的设置
<ul>
<li>在<code> option-&gt;User-&gt;Run User Programs After Buidl/Rebuild</code> 的<code> run #1</code> 中</li>
<li>填写<code> &quot;D:\workspace\android\Android-nRF-Connect-master\init packet handling\hex2bin.exe&quot; _build/nrf51422_xxac_s110.hex</code></li>
<li>每次编译后，生成hex之后会自动调用hex2bin工具生成bin文件</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>制作升级包
<ul>
<li>安装Master Control Panel，我采用最新版3.10.0.14</li>
<li>工具： <code> C:\Program Files (x86)\Nordic Semiconductor\Master Control Panel\3.10.0.14\nrf\nrfutil.exe</code></li>
<li>命令： <code> nrfutil.exe dfu genpkg --application nrf51422_xxac_s110.bin --application-version 0xFFFFFFFF --dev-revision 0xFFFF --dev-type 0xFFFF --sd-req 100 nrf51422_xxac_s110.zip</code>
<ul>
<li><a class="link" href="http://creeus.blogspot.com/2015/09/nrf51822-bootloader.html"  target="_blank" rel="noopener"
    >参数讲解</a>
<ul>
<li><code> --application-version version</code> : the version of the application image, for example, 0xff</li>
<li><code> --dev-revision version</code> : the revision of the device that should accept the image, for example, 1</li>
<li><code> --dev-type type</code> : the type of the device that should accept the image, for example, 1</li>
<li><code> --sd-req sd_list</code> : a comma-separated list of FWID values of SoftDevices that are valid to be used with the new image, for example, 0x4f,0x5a</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>空中升级
<ul>
<li>将zip文件传到手机</li>
<li>打开nrf Beacon，在dfu tab下select file，选择zip文件</li>
<li>点击select device选择DfuTarg</li>
<li>点击upload开始上传更新包</li>
<li>传输完成后，nrf51822重启，进入ble_app_uart应用中</li>
</ul>
</li>
<li>手动方式
<ul>
<li>按住button0然后重新启动nrf51822，进入dfu模式</li>
<li>重复空中升级的手机操作</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p>[Linux下使用armgcc和nrf工具实现DFU升级]</p>
<ul>
<li>准备工作
<ul>
<li>softdevice: SDK_10_PATH/components/softdevice/s130/hex/s130_nrf51_8.0.0_softdevice.hex
<ul>
<li>采用s130，而非Keil中用的s110</li>
</ul>
</li>
<li>bootloader: SDK_10_PATH/examples/dfu/bootloader/pca10028/dual_bank_ble_s130</li>
<li>ble application: SDK_10_PATH/examples/ble_peripheral/ble_app_uart</li>
<li><a class="link" href="https://www.nordicsemi.com/eng/nordic/Products/nRF51822/nRF5x-Command-Line-Tools-Linux64/51386"  target="_blank" rel="noopener"
    >nRF5x-Command-Line-Tool</a></li>
<li><a class="link" href="https://github.com/NordicSemiconductor/pc-nrfutil/tree/0_5_2"  target="_blank" rel="noopener"
    >nrfutil 0.5.2</a>
<ul>
<li><a class="link" href="https://github.com/NordicSemiconductor/pc-nrfutil"  target="_blank" rel="noopener"
    >nrfutil master分支</a>介绍sdk11和sdk11之前的版本用nrfutil-0.5.2，之后的sdk用nrfutil高版本，目前是2.0.0版本。</li>
</ul>
</li>
</ul>
</li>
<li>制作bootloader
<ul>
<li><code>SDK_10_PATH/examples/dfu/bootloader/pca10028/dual_bank_ble_s130/armgcc</code></li>
<li>由于nrf51822 QFAA蛋疼的16KB Ram，所以内存和flash布局要做相应修改，修改 <code>SDK_10_PATH/examples/dfu/bootloader/dfu_gcc_nrf51.ld</code>的相应布局</li>
</ul>
</li>
</ul>
</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">MEMORY
<span class="o">{</span>
  /** Flash start address <span class="k">for</span> the bootloader. This setting will also be stored in UICR to allow the
   *  MBR to init the bootloader when starting the system. This value must correspond to 
   *  BOOTLOADER_REGION_START found in dfu_types.h. The system is prevented from starting up <span class="k">if</span> 
   *  those values <span class="k">do</span> not match. The check is performed in main.c, see
   *  APP_ERROR_CHECK_BOOL<span class="o">(</span>*<span class="o">((</span>uint32_t *<span class="o">)</span>NRF_UICR_BOOT_START_ADDRESS<span class="o">)</span> <span class="o">==</span> BOOTLOADER_REGION_START<span class="o">)</span><span class="p">;</span>
   */
  FLASH <span class="o">(</span>rx<span class="o">)</span> : <span class="nv">ORIGIN</span> <span class="o">=</span> 0x3C000, <span class="nv">LENGTH</span> <span class="o">=</span> 0x3C00

  /** RAM Region <span class="k">for</span> bootloader. This setting is suitable when used with s110, s120, s130, s310. */
  RAM <span class="o">(</span>rwx<span class="o">)</span> :  <span class="nv">ORIGIN</span> <span class="o">=</span> 0x20002C00, <span class="nv">LENGTH</span> <span class="o">=</span> 0x1380

  /** Location of non initialized RAM. Non initialized RAM is used <span class="k">for</span> exchanging bond information
   *  from application to bootloader when using buttonluss DFU OTA. 
   */
  NOINIT <span class="o">(</span>rwx<span class="o">)</span> :  <span class="nv">ORIGIN</span> <span class="o">=</span> 0x20001F80, <span class="nv">LENGTH</span> <span class="o">=</span> 0x80

  /** Location of bootloader setting in at the last flash page. */
  BOOTLOADER_SETTINGS <span class="o">(</span>rw<span class="o">)</span> : <span class="nv">ORIGIN</span> <span class="o">=</span> 0x0003FC00, <span class="nv">LENGTH</span> <span class="o">=</span> 0x0400

  /** Location in UICR where bootloader start address is stored. */
  UICR_BOOTLOADER <span class="o">(</span>r<span class="o">)</span> : <span class="nv">ORIGIN</span> <span class="o">=</span> 0x10001014, <span class="nv">LENGTH</span> <span class="o">=</span> 0x04
<span class="o">}</span>

</code></pre></td></tr></table>
</div>
</div><ul>
<li>
<!-- raw HTML omitted -->
</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">flash: nrf51422_xxac
	@echo Flashing: <span class="k">$(</span>OUTPUT_BINARY_DIRECTORY<span class="k">)</span>/$&lt;.hex
	nrfjprog --program <span class="k">$(</span>OUTPUT_BINARY_DIRECTORY<span class="k">)</span>/$&lt;.hex -f nrf51  --sectorerase
	nrfjprog --reset

<span class="c1">## Flash softdevice</span>
flash_softdevice:
	@echo Flashing: s130_nrf51_1.0.0_softdevice.hex
	nrfjprog --program ../../../../../../components/softdevice/s130/hex/s130_nrf51_1.0.0_softdevice.hex -f nrf51 --chiperase
	nrfjprog --reset

</code></pre></td></tr></table>
</div>
</div><ul>
<li>
<!-- raw HTML omitted -->
</li>
<li>
<p>以上就是根据nordic的sdk10提供的官方bootloader例程和ble_app_uart应用程序实现的空中升级，只是一个最简单的实现，还需要多学习和总结</p>
</li>
<li>
<p>在应用程序中添加dfu支持</p>
<ul>
<li><a class="link" href="http://developer.nordicsemi.com/nRF51_SDK/nRF51_SDK_v8.x.x/doc/8.0.0/s110/html/a00082.html"  target="_blank" rel="noopener"
    >官方文档</a>
<ul>
<li><a class="link" href="http://developer.nordicsemi.com/nRF51_SDK/nRF51_SDK_v8.x.x/doc/8.0.0/s110/html/a00081.html"  target="_blank" rel="noopener"
    >方法</a></li>
<li><a class="link" href="http://developer.nordicsemi.com/nRF51_SDK/nRF51_SDK_v8.x.x/doc/8.0.0/s110/html/a00083.html"  target="_blank" rel="noopener"
    >应用程序切换到dfu</a></li>
<li><a class="link" href="http://blog.chinaunix.net/uid-28852942-id-5753917.html"  target="_blank" rel="noopener"
    >网友供稿</a></li>
</ul>
</li>
</ul>
</li>
<li>
<p>如何提高ble通信速率</p>
<ul>
<li><a class="link" href="http://blog.chinaunix.net/uid-28852942-id-5753308.html"  target="_blank" rel="noopener"
    >csdn</a></li>
</ul>
</li>
</ul>

</section>


    <footer class="article-footer">
    

    </footer>


    
</article>

    

    

     
    
        
    

    <footer class="site-footer">
    <section class="copyright">
        &copy; 
        
        2022 Bg2bkk Site
    </section>
    
    <section class="powerby">
        Built with <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> <br />
        Theme <b><a href="https://github.com/CaiJimmy/hugo-theme-stack" target="_blank" rel="noopener" data-version="3.15.0">Stack</a></b> designed by <a href="https://jimmycai.com" target="_blank" rel="noopener">Jimmy</a>
    </section>
</footer>


    
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    
    <div class="pswp__bg"></div>

    
    <div class="pswp__scroll-wrap">

        
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                
                
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo="crossorigin="anonymous"
                defer
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU="crossorigin="anonymous"
                defer
                >
            </script><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css"crossorigin="anonymous"
            ><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css"crossorigin="anonymous"
            >

            </main>
        </div>
        <script 
                src="https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js"integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z&#43;KMkF24hUW8WePSA9HM="crossorigin="anonymous"
                
                >
            </script><script type="text/javascript" src="/ts/main.js" defer></script>
<script>
    (function () {
        const customFont = document.createElement('link');
        customFont.href = "https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap";

        customFont.type = "text/css";
        customFont.rel = "stylesheet";

        document.head.appendChild(customFont);
    }());
</script>

    </body>
</html>
